<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archivio Via Babelia – Notariqon</title>
    <style>
        body {
            font-family: 'Helvetica', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: white;
            color: #222;
            line-height: 1.8;
        }
        header {
            text-align: center;
            border-bottom: 2px solid #333;
            padding-bottom: 30px;
            margin-bottom: 50px;
        }
        h1 {
            font-size: 2.5em;
            margin: 0 0 10px 0;
        }
        .subtitle {
            font-size: 1.1em;
            color: #555;
            font-style: italic;
        }
        .archive-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .archive-list li {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .archive-list li:last-child {
            border-bottom: none;
        }
        .post-date {
            font-size: 0.9em;
            color: #888;
            font-style: italic;
        }
        .post-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin: 5px 0;
        }
        .post-link {
            color: #222;
            text-decoration: none;
            display: inline-block;
            margin-top: 5px;
            font-size: 0.9em;
        }
        .post-link:hover {
            text-decoration: underline;
        }
        footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }
        footer a {
            color: #555;
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }
        .count {
            text-align: center;
            font-size: 0.9em;
            color: #888;
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Archivio Via Babelia</h1>
        <p class="subtitle">Incontri devozioni idiosincrasie occasioni e qualche pensiero a margine</p>
    </header>

    <div class="count" id="total-count">Caricamento...</div>

    <ul class="archive-list" id="archive-content">
        <li>Caricamento archivio...</li>
    </ul>

    <footer>
        <a href="../index.html#disiecta">← Torna a Notariqon</a>
    </footer>

    <script>
        // Funzione per convertire data italiana in slug
        function makeSlug(dateStr) {
            return dateStr.toLowerCase().replace(/ /g, '-');
        }

        // Funzione per parsare data italiana
        function parseItalianDate(dateStr) {
            const mesi = {
                'gennaio': 0, 'febbraio': 1, 'marzo': 2, 'aprile': 3,
                'maggio': 4, 'giugno': 5, 'luglio': 6, 'agosto': 7,
                'settembre': 8, 'ottobre': 9, 'novembre': 10, 'dicembre': 11
            };
            const parts = dateStr.toLowerCase().split(' ');
            if (parts.length === 3) {
                const day = parseInt(parts[0]);
                const month = mesi[parts[1]];
                const year = parseInt(parts[2]);
                if (!isNaN(day) && month !== undefined && !isNaN(year)) {
                    return new Date(year, month, day);
                }
            }
            return new Date(0);
        }

        // Carica e visualizza l'archivio completo
        async function loadArchive() {
            try {
                const response = await fetch('../data/disiecta.json');
                const posts = await response.json();

                // Ordina per data decrescente
                posts.sort((a, b) => parseItalianDate(b.date) - parseItalianDate(a.date));

                // Aggiorna contatore
                document.getElementById('total-count').textContent = 
                    `${posts.length} ${posts.length === 1 ? 'contenuto' : 'contenuti'} pubblicati`;

                // Genera lista
                const container = document.getElementById('archive-content');
                let html = '';

                posts.forEach(post => {
                    const slug = makeSlug(post.date);
                    const filename = `${slug}.html`;
                    
                    html += `
                        <li>
                            <div class="post-date">${post.date}</div>
                            <div class="post-title">${post.title}</div>
                            <a href="${filename}" class="post-link" target="_blank" rel="noopener">Leggi →</a>
                        </li>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                document.getElementById('archive-content').innerHTML = 
                    '<li style="color:#999; font-style:italic;">Errore nel caricamento dell\'archivio.</li>';
                console.error('Errore:', error);
            }
        }

        window.onload = loadArchive;
    </script>
</body>
</html>
